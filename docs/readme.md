
# Package release manual
1. Make a dev virtual environment:
  ```bash
  virtualenv .venvdev
  source .venvdev/bin/activate
  pip install .[dev]
  pip install setuptools wheel twine build
  ```
2. Update `setup.py` with a current version number.
3. Compile documentation following the Documentation manual below.
```bash
# Make sure to uninstall the package otherwise pdoc mismatches it
pip uninstall redistributor
```
4. Test the code with automated tests:
  ```bash
  pytest tests.py
  ```
5. Make sure Pypi API tokens are in `~/.pypirc`
```sml
[pypi]
  username = __token__
  password = pypi-AgEIcHlwaS...
```
6. Build and upload to Pypi
```bash
python -m build
```
7. Optionally test the build by installing `.whl` directly
```
pip install dist/redistributor-<version>-py3-none-any.whl
# And try to import it in REPL
```
8. Upload the build to Pypi:
```
twine upload dist/*
```
7. Commit and push to origin.
8. Tag the commit with a version number:
```bash
git tag <tagname> -m "Tag message"
git push origin <tag>
```
9. Remove the dev virtual environment and clean the project:
```
deactivate
rm -r .venvdev
rm -r dist __pycache__ redistributor.egg-info
```

# Documentation manual

This is a manual which specifies how to compile the documentation into `html` and `pdf` formats. Instructions only for Ubuntu.

The documentation is autogenerated from docstrings using `pydoc3` package and enriched by markdown files. Docstrings are written in [numpydoc](https://numpydoc.readthedocs.io/en/latest/format.html) style and markdown files are written in [GitLab flavour](https://about.gitlab.com/handbook/markdown-guide/) with support for [emojis](https://www.webfx.com/tools/emoji-cheat-sheet/) and with [KaTeX](https://github.com/KaTeX/KaTeX) subset of LaTeX for rendering math notation.


## Dependencies
Make sure to have the `[dev]` dependencies installed as specified in the main readme file of the documentation. For pdf output, additional packages need to be installed:
```
sudo apt install texlive-latex-recommended
sudo apt install texlive-latex-extra
sudo apt install texlive-xetex
```

## Development
To interactively review changes in the documentation while developing the package use the pdoc server:
```
pdoc . --http localhost:8080 --config latex_math=True
```

## Compilation

### :page_with_curl: HTML output
To support inline math with `$` delimiter, we customized the `head.mako` template now located in `docs/templates`.
```
pdoc . --html --output-dir docs --force --config latex_math=True --template-dir docs/templates
```

### :notebook_with_decorative_cover: PDF output
```
pdoc . --pdf | pandoc --metadata=title:"Redistributor Documentation" --from=markdown+abbreviations+tex_math_dollars --pdf-engine=xelatex --variable=mainfont:"DejaVu Sans" --toc --toc-depth=4 --output=docs/redistributor.pdf
```
